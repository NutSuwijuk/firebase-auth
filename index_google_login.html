<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Login - Google Identity Services</title>
  
  <!-- Google Identity Services SDK -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 16px;
    }

    .button-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .button {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      margin-bottom: 15px;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .button.google {
      background: #4285f4;
      color: white;
    }

    .button.google:hover {
      background: #357ae8;
    }

    .button.logout {
      background: #dc3545;
      color: white;
    }

    .button.logout:hover {
      background: #c82333;
    }

    .info-section {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      display: none;
    }

    .info-section h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .info-section p {
      color: #666;
      margin-bottom: 10px;
      word-break: break-all;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
      border: 1px solid #f5c6cb;
    }

    textarea {
      resize: vertical;
      width: 100%;
      height: 200px;
      font-family: monospace;
      font-size: 12px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: #f5f5f5;
    }

    .warning-box {
      background: #fff3cd;
      color: #856404;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #ffc107;
    }

    .warning-box h4 {
      margin-bottom: 10px;
      color: #856404;
    }

    .warning-box p {
      margin: 5px 0;
      font-size: 14px;
    }

    .warning-box code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîê Google Login</h1>
      <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ Login ‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á ID Token</p>
    </div>

    <!-- Warning box ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Client ID -->
    <div id="clientIdWarning" class="warning-box" style="display: none;">
      <h4>‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google OAuth Client ID</h4>
      <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î <code>const GOOGLE_CLIENT_ID = ...</code></p>
      <p style="margin-top: 10px;"><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Client ID:</strong></p>
      <p>1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></p>
      <p>2. APIs & Services > Credentials</p>
      <p>3. Create Credentials > OAuth client ID</p>
      <p>4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Web application ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Authorized JavaScript origins</p>
    </div>

    <!-- Warning box ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö origin_mismatch error -->
    <div id="originMismatchWarning" class="warning-box" style="display: none; background: #f8d7da; border-color: #dc3545; color: #721c24;">
      <h4>‚ùå Error: origin_mismatch (400)</h4>
      <p><strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</strong> JavaScript origin ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å register ‡πÉ‡∏ô Google Cloud Console</p>
      <p style="margin-top: 10px;"><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong></p>
      <ol style="margin-left: 20px; margin-top: 10px;">
        <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
        <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Project: <strong>TSB-GO-App-Dev</strong></li>
        <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <strong>APIs & Services > Credentials</strong></li>
        <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà OAuth 2.0 Client ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Client ID: <code>266274251473-e88r4lf2g36gfigqdn31tm0rdij6pi1p</code>)</li>
        <li>‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô <strong>"Authorized JavaScript origins"</strong> ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°:</li>
        <ul style="margin-left: 20px; margin-top: 5px;">
          <li><code id="currentOrigin">http://localhost</code> (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö local development)</li>
          <li>‡∏´‡∏£‡∏∑‡∏≠ <code>file://</code> (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á)</li>
          <li>‡∏´‡∏£‡∏∑‡∏≠ domain ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô <code>https://yourdomain.com</code>)</li>
        </ul>
        <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>"Save"</strong></li>
        <li>‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏Å 1-2 ‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</li>
      </ol>
      <p style="margin-top: 10px; font-size: 12px; color: #856404;">
        <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> Origin ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: <code id="detectedOrigin"></code>
      </p>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏° Login ‡∏î‡πâ‡∏ß‡∏¢ Google -->
    <button id="googleLoginBtn" class="button google" onclick="signInWithGoogle()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
      </svg>
      Login with Google
    </button>

    <!-- ‡∏õ‡∏∏‡πà‡∏° Logout -->
    <button id="googleLogoutBtn" class="button logout" onclick="signOut()" style="display: none;">
      Logout
    </button>

    <!-- ‡πÅ‡∏™‡∏î‡∏á Error Message -->
    <div id="errorMessage" class="error-message"></div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <div id="userInfo" class="info-section"></div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á ID Token -->
    <div id="idToken" class="info-section"></div>
  </div>

  <script>
    // ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Google OAuth Client ID (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Firebase API Key)
    // 
    // üìç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Google OAuth Client ID:
    // 
    // 1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà: https://console.cloud.google.com/
    // 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Project ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)
    // 3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà: APIs & Services > Credentials
    // 4. ‡∏Ñ‡∏•‡∏¥‡∏Å: "Create Credentials" > "OAuth client ID"
    // 5. ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ OAuth consent screen:
    //    - ‡∏Ñ‡∏•‡∏¥‡∏Å "Configure Consent Screen"
    //    - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "External" (‡∏´‡∏£‡∏∑‡∏≠ "Internal" ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Google Workspace)
    //    - ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• App name, User support email
    //    - ‡∏Ñ‡∏•‡∏¥‡∏Å "Save and Continue" ‡∏à‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à
    // 6. ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà Credentials > Create Credentials > OAuth client ID
    // 7. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Application type: "Web application"
    // 8. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô "My Web App")
    // 9. Authorized JavaScript origins:
    //    - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö local: http://localhost:PORT (‡πÄ‡∏ä‡πà‡∏ô http://localhost:3000)
    //    - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production: https://yourdomain.com
    // 10. ‡∏Ñ‡∏•‡∏¥‡∏Å "Create"
    // 11. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å "Client ID" (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: xxxxxx-xxxxx.apps.googleusercontent.com)
    const GOOGLE_CLIENT_ID = '266274251473-e88r4lf2g36gfigqdn31tm0rdij6pi1p.apps.googleusercontent.com';

    // DOM Elements
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const googleLogoutBtn = document.getElementById('googleLogoutBtn');
    const errorMessage = document.getElementById('errorMessage');
    const userInfo = document.getElementById('userInfo');
    const idToken = document.getElementById('idToken');
    const clientIdWarning = document.getElementById('clientIdWarning');
    const originMismatchWarning = document.getElementById('originMismatchWarning');
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö origin ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    const currentOrigin = window.location.origin || (window.location.protocol + '//' + window.location.host);
    if (document.getElementById('currentOrigin')) {
      document.getElementById('currentOrigin').textContent = currentOrigin;
    }
    if (document.getElementById('detectedOrigin')) {
      document.getElementById('detectedOrigin').textContent = currentOrigin || 'file://';
    }

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö Google Sign-In instance
    let googleSignInInitialized = false;

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ callback ‡∏à‡∏≤‡∏Å Google Sign-In
     * @param {Object} response - Response object ‡∏à‡∏≤‡∏Å Google ‡∏ó‡∏µ‡πà‡∏°‡∏µ credential
     * ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö Flutter handleGoogleSignIn callback
     */
    function handleGoogleSignIn(response) {
      try {
        console.log('üîë Google Sign-In response received:', response);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ credential ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!response || !response.credential) {
          const error = 'Google Sign-In was cancelled or no credential received';
          console.error('‚ùå', error);
          showError(error);
          
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô origin_mismatch error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          if (window.location.href.includes('origin_mismatch') || 
              window.location.href.includes('oauth/error')) {
            showOriginMismatchWarning();
          }
          
          // Resolve promise ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
          if (window._googleSignInResolve) {
            window._googleSignInResolve({ error: error });
            window._googleSignInResolve = null;
          }
          return;
        }

        // ‡πÄ‡∏Å‡πá‡∏ö ID token
        const idTokenValue = response.credential;
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ token ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!idTokenValue) {
          const error = 'Failed to get Google authentication tokens';
          console.error('‚ùå', error);
          showError(error);
          
          // Resolve promise ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
          if (window._googleSignInResolve) {
            window._googleSignInResolve({ error: error });
            window._googleSignInResolve = null;
          }
          return;
        }

        // Print log id token
        console.log('‚úÖ Google Sign-In successful!');
        console.log('üìã ID Token:', idTokenValue);
        console.log('üìã ID Token (first 50 chars):', idTokenValue.substring(0, 50) + '...');

        // Decode JWT token ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÑ‡∏°‡πà verify signature - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
        let userInfoData = {};
        let email = null;
        let displayName = null;
        
        try {
          const tokenParts = idTokenValue.split('.');
          if (tokenParts.length === 3) {
            const payload = JSON.parse(atob(tokenParts[1]));
            email = payload.email || null;
            displayName = payload.name || null;
            
            userInfoData = {
              email: email,
              name: displayName,
              picture: payload.picture || 'N/A',
              given_name: payload.given_name || 'N/A',
              family_name: payload.family_name || 'N/A',
              email_verified: payload.email_verified || false,
              sub: payload.sub || 'N/A',
              iss: payload.iss || 'N/A',
              aud: payload.aud || 'N/A',
              exp: payload.exp || 'N/A'
            };
            console.log('üë§ User Info:', userInfoData);
            console.log(`‚úÖ Google Sign-In successful for user: ${email}`);
          }
        } catch (decodeError) {
          console.warn('‚ö†Ô∏è Could not decode token (non-critical):', decodeError);
          userInfoData = { error: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ decode token ‡πÑ‡∏î‡πâ' };
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á result object (‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö SocialAuthResult ‡πÉ‡∏ô Flutter)
        const result = {
          idToken: idTokenValue,
          email: email,
          displayName: displayName,
          userInfo: userInfoData
        };

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        displayUserInfo(userInfoData, idTokenValue);

        // Resolve promise ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        if (window._googleSignInResolve) {
          window._googleSignInResolve(result);
          window._googleSignInResolve = null;
        }

        return result;

      } catch (error) {
        console.error('‚ùå General Exception during Google Sign-In:', error);
        const errorMessage = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google: ${error.toString()}`;
        showError('‚ùå ' + errorMessage);
        
        // Resolve promise ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        if (window._googleSignInResolve) {
          window._googleSignInResolve({ error: errorMessage });
          window._googleSignInResolve = null;
        }
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞ id token ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
     * @param {Object} userInfoData - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà decode ‡∏à‡∏≤‡∏Å token
     * @param {string} idTokenValue - Google ID Token
     */
    function displayUserInfo(userInfoData, idTokenValue) {
      // ‡∏ã‡πà‡∏≠‡∏ô error
      if (errorMessage) {
        errorMessage.style.display = 'none';
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      if (userInfo) {
        userInfo.innerHTML = `
          <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
          <p><strong>Email:</strong> ${userInfoData.email || 'N/A'}</p>
          <p><strong>Name:</strong> ${userInfoData.name || 'N/A'}</p>
          <p><strong>Given Name:</strong> ${userInfoData.given_name || 'N/A'}</p>
          <p><strong>Family Name:</strong> ${userInfoData.family_name || 'N/A'}</p>
          <p><strong>Email Verified:</strong> ${userInfoData.email_verified ? 'Yes' : 'No'}</p>
          <p><strong>Sub (User ID):</strong> ${userInfoData.sub || 'N/A'}</p>
          ${userInfoData.picture ? `<p><strong>Picture:</strong> <a href="${userInfoData.picture}" target="_blank">${userInfoData.picture}</a></p>` : ''}
        `;
        userInfo.style.display = 'block';
      }

      // ‡πÅ‡∏™‡∏î‡∏á ID Token
      if (idToken) {
        idToken.innerHTML = `
          <h3>üîë ID Token</h3>
          <textarea readonly>${idTokenValue}</textarea>
        `;
        idToken.style.display = 'block';
      }

      // ‡∏ã‡πà‡∏≠‡∏ô Google Login button ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° logout
      if (googleLoginBtn) {
        googleLoginBtn.style.display = 'none';
      }
      if (googleLogoutBtn) {
        googleLogoutBtn.style.display = 'block';
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á error message
     * @param {string} message - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error
     */
    function showError(message) {
      if (errorMessage) {
        errorMessage.textContent = `‚ùå ${message}`;
        errorMessage.style.display = 'block';
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô origin_mismatch error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (message.includes('origin_mismatch') || 
          message.includes('400') ||
          window.location.href.includes('origin_mismatch')) {
        showOriginMismatchWarning();
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á warning ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö origin_mismatch
     */
    function showOriginMismatchWarning() {
      if (originMismatchWarning) {
        originMismatchWarning.style.display = 'block';
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö logout
     */
    function signOut() {
      try {
        // Clear ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á
        if (userInfo) userInfo.style.display = 'none';
        if (idToken) idToken.style.display = 'none';
        if (errorMessage) errorMessage.style.display = 'none';
        if (googleLogoutBtn) googleLogoutBtn.style.display = 'none';
        if (googleLoginBtn) googleLoginBtn.style.display = 'block';

        // Google Identity Services ‡πÑ‡∏°‡πà‡∏°‡∏µ signOut function ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        // ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° login ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
        console.log('‚úÖ Logout ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        
      } catch (error) {
        console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Logout:', error);
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö initialize Google Sign-In
     * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
     */
    function initializeGoogleSignIn() {
      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Google Identity Services SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
      if (typeof google !== 'undefined' && google.accounts) {
        console.log('üîë Initializing Google Sign-In...');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ client_id ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        if (!GOOGLE_CLIENT_ID || GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_OAUTH_CLIENT_ID_HERE.apps.googleusercontent.com') {
          console.error('‚ùå Google OAuth Client ID ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤!');
          showError('‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google OAuth Client ID\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: const GOOGLE_CLIENT_ID = "...";');
          
          // ‡πÅ‡∏™‡∏î‡∏á warning box
          if (clientIdWarning) {
            clientIdWarning.style.display = 'block';
          }
          
          if (googleLoginBtn) {
            googleLoginBtn.disabled = true;
            googleLoginBtn.style.opacity = '0.5';
            googleLoginBtn.style.cursor = 'not-allowed';
          }
          return;
        }
        
        try {
          // Initialize Google Sign-In
          google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true
          });

          googleSignInInitialized = true;
          console.log('‚úÖ Google Sign-In initialized with Client ID:', GOOGLE_CLIENT_ID.substring(0, 20) + '...');
          
          // ‡∏ã‡πà‡∏≠‡∏ô warning box ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
          if (clientIdWarning) {
            clientIdWarning.style.display = 'none';
          }
          
          if (googleLoginBtn) {
            googleLoginBtn.disabled = false;
            googleLoginBtn.style.opacity = '1';
            googleLoginBtn.style.cursor = 'pointer';
          }
          
        } catch (error) {
          console.error('‚ùå Error initializing Google Sign-In:', error);
          showError('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ initialize Google Sign-In\n\nError: ' + error.message);
        }
      } else {
        // ‡∏ñ‡πâ‡∏≤ SDK ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
        console.log('‚è≥ Waiting for Google Identity Services SDK...');
        setTimeout(initializeGoogleSignIn, 500);
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login ‡∏î‡πâ‡∏ß‡∏¢ Google
     * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° Login with Google
     * ‡πÉ‡∏ä‡πâ Google Identity Services SDK ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á popup login
     * ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö Flutter signInWithGoogle() function
     */
    async function signInWithGoogle() {
      try {
        console.log('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Google Login...');

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        if (typeof google === 'undefined' || !google.accounts) {
          const error = 'Google Identity Services SDK ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à';
          console.error('‚ùå', error);
          showError(error);
          return { error: error };
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ client_id ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        if (!GOOGLE_CLIENT_ID || GOOGLE_CLIENT_ID === 'YOUR_GOOGLE_OAUTH_CLIENT_ID_HERE.apps.googleusercontent.com') {
          const error = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google OAuth Client ID';
          console.error('‚ùå', error);
          showError('‚ö†Ô∏è ' + error + '\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: const GOOGLE_CLIENT_ID = "...";');
          return { error: error };
        }

        // ‡∏•‡πâ‡∏≤‡∏á session ‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        // Google Identity Services ‡πÑ‡∏°‡πà‡∏°‡∏µ signOut ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ
        if (userInfo) userInfo.style.display = 'none';
        if (idToken) idToken.style.display = 'none';
        if (errorMessage) errorMessage.style.display = 'none';

        // Initialize Google Sign-In ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ initialize
        if (!googleSignInInitialized) {
          google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true
          });
          googleSignInInitialized = true;
        }

        // ‡πÉ‡∏ä‡πâ renderButton ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á popup login
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á container ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö render button
        const buttonContainer = document.createElement('div');
        buttonContainer.style.position = 'absolute';
        buttonContainer.style.left = '-9999px';
        buttonContainer.style.top = '-9999px';
        document.body.appendChild(buttonContainer);

        // Render button
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: width ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (pixels) ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà percentage
        google.accounts.id.renderButton(buttonContainer, {
          type: 'standard',
          theme: 'outline',
          size: 'large',
          text: 'signin_with',
          width: 300  // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏ó‡∏ô '100%'
        });

        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ button render ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å
        return new Promise((resolve) => {
          setTimeout(() => {
            const button = buttonContainer.querySelector('div[role="button"]');
            if (button) {
              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ callback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö resolve promise
              window._googleSignInResolve = resolve;
              
              // ‡∏Ñ‡∏•‡∏¥‡∏Å button
              button.click();
              
              // ‡∏•‡∏ö container ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
              setTimeout(() => {
                if (buttonContainer.parentNode) {
                  buttonContainer.parentNode.removeChild(buttonContainer);
                }
              }, 100);
            } else {
              // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö button ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ prompt ‡πÅ‡∏ó‡∏ô
              google.accounts.id.prompt((notification) => {
                if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                  const error = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á Google Sign-In ‡πÑ‡∏î‡πâ';
                  console.error('‚ùå', error);
                  showError(error);
                  if (buttonContainer.parentNode) {
                    buttonContainer.parentNode.removeChild(buttonContainer);
                  }
                  resolve({ error: error });
                }
              });
            }
          }, 100);
        });

      } catch (error) {
        console.error('‚ùå General Exception during Google Sign-In:', error);
        const errorMessage = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google: ${error.toString()}`;
        showError('‚ùå ' + errorMessage);
        return { error: errorMessage };
      }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    window.addEventListener('load', () => {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô origin_mismatch error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (window.location.href.includes('origin_mismatch') || 
          window.location.href.includes('oauth/error')) {
        showOriginMismatchWarning();
      }
      
      setTimeout(initializeGoogleSignIn, 1000); // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Google SDK ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    });

    // Export function ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô HTML
    window.signInWithGoogle = signInWithGoogle;
    window.signOut = signOut;
  </script>
</body>
</html>
