<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google & Apple Login - Direct OAuth</title>
  
  <!-- Google Identity Services SDK -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  
  <!-- Apple Sign In SDK -->
  <script type="text/javascript" src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #333;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 16px;
    }

    .button-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
    }

    .button {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .button.google {
      background: #4285f4;
      color: white;
    }

    .button.google:hover:not(:disabled) {
      background: #357ae8;
    }

    .button.apple {
      background: #000000;
      color: white;
    }

    .button.apple:hover:not(:disabled) {
      background: #333333;
    }

    .button.logout {
      background: #dc3545;
      color: white;
    }

    .button.logout:hover {
      background: #c82333;
    }

    .info-section {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      display: none;
    }

    .info-section h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .info-section p {
      color: #666;
      margin-bottom: 10px;
      word-break: break-all;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
      border: 1px solid #f5c6cb;
    }

    textarea {
      resize: vertical;
      width: 100%;
      height: 200px;
      font-family: monospace;
      font-size: 12px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: #f5f5f5;
    }

    .warning-box {
      background: #fff3cd;
      color: #856404;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border: 1px solid #ffc107;
    }

    .warning-box h4 {
      margin-bottom: 10px;
      color: #856404;
    }

    .warning-box p {
      margin: 5px 0;
      font-size: 14px;
    }

    .warning-box code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }

    .log-section {
      margin-top: 20px;
      padding: 15px;
      background: #e7f3ff;
      border-radius: 10px;
      border: 1px solid #b3d9ff;
    }

    .log-section h4 {
      color: #004085;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .log-content {
      background: #ffffff;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 11px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîê Google & Apple Login</h1>
      <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ Login ‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÅ‡∏•‡∏∞ Apple (‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô Firebase)</p>
    </div>

    <!-- Warning box ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Client ID -->
    <div id="clientIdWarning" class="warning-box" style="display: none;">
      <h4>‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ OAuth Client ID</h4>
      <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î <code>const GOOGLE_CLIENT_ID = ...</code> ‡πÅ‡∏•‡∏∞ <code>const APPLE_CLIENT_ID = ...</code></p>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏° Login -->
    <div class="button-container">
      <button id="googleLoginBtn" class="button google" onclick="signInWithGoogle()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
          <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
          <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
          <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
        </svg>
        Login with Google
      </button>

      <button id="appleLoginBtn" class="button apple" onclick="signInWithApple()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
        </svg>
        Login with Apple
      </button>

      <button id="logoutBtn" class="button logout" onclick="signOut()" style="display: none;">
        Logout
      </button>
    </div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á Error Message -->
    <div id="errorMessage" class="error-message"></div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
    <div id="userInfo" class="info-section"></div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á Token -->
    <div id="tokenInfo" class="info-section"></div>

    <!-- ‡πÅ‡∏™‡∏î‡∏á Log -->
    <div id="logSection" class="log-section" style="display: none;">
      <h4>üìã Console Logs (Token Information)</h4>
      <div id="logContent" class="log-content"></div>
    </div>
  </div>

  <script>
    // ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Client ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google ‡πÅ‡∏•‡∏∞ Apple
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google: ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://console.cloud.google.com/ > APIs & Services > Credentials
    const GOOGLE_CLIENT_ID = '407047949381-8r5beccl81cd50jfebhiha6m6svbtqb6.apps.googleusercontent.com';
    
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Apple: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Apple Developer Account ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Service ID
    // ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://developer.apple.com/account/resources/identifiers/list/serviceId
    const APPLE_CLIENT_ID = 'YOUR_APPLE_SERVICE_ID_HERE'; // ‡πÄ‡∏ä‡πà‡∏ô: com.example.app
    const APPLE_REDIRECT_URI = window.location.origin + window.location.pathname; // ‡πÉ‡∏ä‡πâ origin ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

    // DOM Elements
    const googleLoginBtn = document.getElementById('googleLoginBtn');
    const appleLoginBtn = document.getElementById('appleLoginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const errorMessage = document.getElementById('errorMessage');
    const userInfo = document.getElementById('userInfo');
    const tokenInfo = document.getElementById('tokenInfo');
    const logSection = document.getElementById('logSection');
    const logContent = document.getElementById('logContent');
    const clientIdWarning = document.getElementById('clientIdWarning');

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö state
    let googleSignInInitialized = false;
    let currentProvider = null; // 'google' ‡∏´‡∏£‡∏∑‡∏≠ 'apple'
    let allTokens = {}; // ‡πÄ‡∏Å‡πá‡∏ö token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° log ‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
     * @param {string} message - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ log
     * @param {string} type - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó log ('info', 'success', 'error', 'token')
     */
    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString('th-TH');
      const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'token' ? 'üîë' : '‚ÑπÔ∏è';
      const logLine = `[${timestamp}] ${prefix} ${message}\n`;
      
      // Log ‡πÑ‡∏õ‡∏ó‡∏µ‡πà console
      if (type === 'error') {
        console.error(logLine.trim());
      } else if (type === 'token') {
        console.log('üîë TOKEN:', logLine.trim());
      } else {
        console.log(logLine.trim());
      }
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏° log ‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
      if (logContent) {
        logContent.textContent += logLine;
        logSection.style.display = 'block';
        // Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î
        logContent.scrollTop = logContent.scrollHeight;
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö log token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     * @param {Object} tokens - object ‡∏ó‡∏µ‡πà‡∏°‡∏µ token ‡∏ï‡πà‡∏≤‡∏á‡πÜ
     * @param {string} provider - provider name ('google' ‡∏´‡∏£‡∏∑‡∏≠ 'apple')
     */
    function logAllTokens(tokens, provider) {
      addLog(`=== ${provider.toUpperCase()} LOGIN TOKENS ===`, 'token');
      addLog(`Provider: ${provider}`, 'token');
      
      // ‡πÄ‡∏Å‡πá‡∏ö token ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô allTokens
      allTokens[provider] = tokens;
      
      // Log ‡πÅ‡∏ï‡πà‡∏•‡∏∞ token
      Object.keys(tokens).forEach(key => {
        const value = tokens[key];
        if (typeof value === 'string' && value.length > 100) {
          // ‡∏ñ‡πâ‡∏≤ token ‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢
          addLog(`${key}: ${value.substring(0, 50)}...${value.substring(value.length - 20)} (length: ${value.length})`, 'token');
        } else if (typeof value === 'object') {
          addLog(`${key}: ${JSON.stringify(value, null, 2)}`, 'token');
        } else {
          addLog(`${key}: ${value}`, 'token');
        }
      });
      
      addLog(`=== END ${provider.toUpperCase()} TOKENS ===`, 'token');
      addLog('', 'info');
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ callback ‡∏à‡∏≤‡∏Å Google Sign-In
     * @param {Object} response - Response object ‡∏à‡∏≤‡∏Å Google ‡∏ó‡∏µ‡πà‡∏°‡∏µ credential
     */
    function handleGoogleSignIn(response) {
      try {
        addLog('Google Sign-In response received', 'info');
        console.log('üîë Google Sign-In response:', response);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ credential ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!response || !response.credential) {
          const error = 'Google Sign-In was cancelled or no credential received';
          addLog(error, 'error');
          showError(error);
          return;
        }

        // ‡πÄ‡∏Å‡πá‡∏ö ID token
        const idTokenValue = response.credential;
        
        // Decode JWT token ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        let userInfoData = {};
        let decodedToken = null;
        
        try {
          const tokenParts = idTokenValue.split('.');
          if (tokenParts.length === 3) {
            decodedToken = {
              header: JSON.parse(atob(tokenParts[0])),
              payload: JSON.parse(atob(tokenParts[1])),
              signature: tokenParts[2]
            };
            
            userInfoData = {
              email: decodedToken.payload.email || null,
              name: decodedToken.payload.name || null,
              picture: decodedToken.payload.picture || 'N/A',
              given_name: decodedToken.payload.given_name || 'N/A',
              family_name: decodedToken.payload.family_name || 'N/A',
              email_verified: decodedToken.payload.email_verified || false,
              sub: decodedToken.payload.sub || 'N/A',
              iss: decodedToken.payload.iss || 'N/A',
              aud: decodedToken.payload.aud || 'N/A',
              exp: decodedToken.payload.exp || 'N/A',
              iat: decodedToken.payload.iat || 'N/A'
            };
          }
        } catch (decodeError) {
          addLog('Could not decode token: ' + decodeError.message, 'error');
          console.warn('‚ö†Ô∏è Could not decode token:', decodeError);
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á tokens object ‡∏ó‡∏µ‡πà‡∏°‡∏µ token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const tokens = {
          idToken: idTokenValue,
          accessToken: null, // Google Identity Services ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ access token ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
          decodedToken: decodedToken,
          rawResponse: response
        };

        // Log token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        logAllTokens(tokens, 'google');

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        displayUserInfo(userInfoData, tokens, 'google');
        currentProvider = 'google';

        addLog('Google Sign-In successful!', 'success');

      } catch (error) {
        addLog('Error during Google Sign-In: ' + error.toString(), 'error');
        console.error('‚ùå General Exception during Google Sign-In:', error);
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google: ' + error.toString());
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ callback ‡∏à‡∏≤‡∏Å Apple Sign-In
     * @param {Object} event - Event object ‡∏à‡∏≤‡∏Å Apple
     */
    function handleAppleSignIn(event) {
      try {
        addLog('Apple Sign-In response received', 'info');
        console.log('üîë Apple Sign-In response:', event);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ credential ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!event || !event.detail) {
          const error = 'Apple Sign-In was cancelled or no credential received';
          addLog(error, 'error');
          showError(error);
          return;
        }

        const detail = event.detail;
        
        // ‡πÄ‡∏Å‡πá‡∏ö token ‡∏à‡∏≤‡∏Å Apple
        const idToken = detail.id_token || null;
        const authorizationCode = detail.authorization?.code || null;
        const user = detail.user || null;
        const state = detail.state || null;

        // Decode JWT token ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        let userInfoData = {};
        let decodedToken = null;
        
        if (idToken) {
          try {
            const tokenParts = idToken.split('.');
            if (tokenParts.length === 3) {
              decodedToken = {
                header: JSON.parse(atob(tokenParts[0])),
                payload: JSON.parse(atob(tokenParts[1])),
                signature: tokenParts[2]
              };
              
              userInfoData = {
                email: decodedToken.payload.email || user?.email || null,
                name: user?.name || null,
                sub: decodedToken.payload.sub || 'N/A',
                iss: decodedToken.payload.iss || 'N/A',
                aud: decodedToken.payload.aud || 'N/A',
                exp: decodedToken.payload.exp || 'N/A',
                iat: decodedToken.payload.iat || 'N/A'
              };
            }
          } catch (decodeError) {
            addLog('Could not decode Apple token: ' + decodeError.message, 'error');
            console.warn('‚ö†Ô∏è Could not decode Apple token:', decodeError);
          }
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á tokens object ‡∏ó‡∏µ‡πà‡∏°‡∏µ token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const tokens = {
          idToken: idToken,
          authorizationCode: authorizationCode,
          user: user,
          state: state,
          decodedToken: decodedToken,
          rawResponse: detail
        };

        // Log token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        logAllTokens(tokens, 'apple');

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        displayUserInfo(userInfoData, tokens, 'apple');
        currentProvider = 'apple';

        addLog('Apple Sign-In successful!', 'success');

      } catch (error) {
        addLog('Error during Apple Sign-In: ' + error.toString(), 'error');
        console.error('‚ùå General Exception during Apple Sign-In:', error);
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Apple: ' + error.toString());
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞ token ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
     * @param {Object} userInfoData - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
     * @param {Object} tokens - token ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     * @param {string} provider - provider name
     */
    function displayUserInfo(userInfoData, tokens, provider) {
      // ‡∏ã‡πà‡∏≠‡∏ô error
      if (errorMessage) {
        errorMessage.style.display = 'none';
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      if (userInfo) {
        userInfo.innerHTML = `
          <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (${provider.toUpperCase()})</h3>
          <p><strong>Email:</strong> ${userInfoData.email || 'N/A'}</p>
          <p><strong>Name:</strong> ${userInfoData.name || 'N/A'}</p>
          ${userInfoData.given_name ? `<p><strong>Given Name:</strong> ${userInfoData.given_name}</p>` : ''}
          ${userInfoData.family_name ? `<p><strong>Family Name:</strong> ${userInfoData.family_name}</p>` : ''}
          ${userInfoData.email_verified !== undefined ? `<p><strong>Email Verified:</strong> ${userInfoData.email_verified ? 'Yes' : 'No'}</p>` : ''}
          <p><strong>Sub (User ID):</strong> ${userInfoData.sub || 'N/A'}</p>
          ${userInfoData.picture ? `<p><strong>Picture:</strong> <a href="${userInfoData.picture}" target="_blank">${userInfoData.picture}</a></p>` : ''}
        `;
        userInfo.style.display = 'block';
      }

      // ‡πÅ‡∏™‡∏î‡∏á Token
      if (tokenInfo) {
        const tokenText = JSON.stringify(tokens, null, 2);
        tokenInfo.innerHTML = `
          <h3>üîë Token Information (${provider.toUpperCase()})</h3>
          <textarea readonly>${tokenText}</textarea>
        `;
        tokenInfo.style.display = 'block';
      }

      // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° login ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° logout
      if (googleLoginBtn) googleLoginBtn.style.display = 'none';
      if (appleLoginBtn) appleLoginBtn.style.display = 'none';
      if (logoutBtn) logoutBtn.style.display = 'block';
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á error message
     * @param {string} message - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error
     */
    function showError(message) {
      if (errorMessage) {
        errorMessage.textContent = `‚ùå ${message}`;
        errorMessage.style.display = 'block';
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö logout
     */
    function signOut() {
      try {
        // Clear ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á
        if (userInfo) userInfo.style.display = 'none';
        if (tokenInfo) tokenInfo.style.display = 'none';
        if (errorMessage) errorMessage.style.display = 'none';
        if (logoutBtn) logoutBtn.style.display = 'none';
        if (googleLoginBtn) googleLoginBtn.style.display = 'block';
        if (appleLoginBtn) appleLoginBtn.style.display = 'block';

        // Clear tokens
        allTokens = {};
        currentProvider = null;

        addLog('Logout ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        console.log('‚úÖ Logout ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        
      } catch (error) {
        addLog('Error during logout: ' + error.toString(), 'error');
        console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Logout:', error);
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö initialize Google Sign-In
     */
    function initializeGoogleSignIn() {
      if (typeof google !== 'undefined' && google.accounts) {
        addLog('Initializing Google Sign-In...', 'info');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ client_id ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        if (!GOOGLE_CLIENT_ID || GOOGLE_CLIENT_ID.includes('407047949381-8r5beccl81cd50jfebhiha6m6svbtqb6.apps.googleusercontent.com')) {
          addLog('Google OAuth Client ID ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤!', 'error');
          showError('‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google OAuth Client ID');
          if (clientIdWarning) {
            clientIdWarning.style.display = 'block';
          }
          if (googleLoginBtn) {
            googleLoginBtn.disabled = true;
          }
          return;
        }
        
        try {
          google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true
          });

          googleSignInInitialized = true;
          addLog('Google Sign-In initialized successfully', 'success');
          
          if (clientIdWarning) {
            clientIdWarning.style.display = 'none';
          }
          if (googleLoginBtn) {
            googleLoginBtn.disabled = false;
          }
          
        } catch (error) {
          addLog('Error initializing Google Sign-In: ' + error.message, 'error');
          showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ initialize Google Sign-In: ' + error.message);
        }
      } else {
        setTimeout(initializeGoogleSignIn, 500);
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö initialize Apple Sign-In
     */
    function initializeAppleSignIn() {
      if (typeof AppleID !== 'undefined') {
        addLog('Initializing Apple Sign-In...', 'info');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ client_id ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        if (!APPLE_CLIENT_ID || APPLE_CLIENT_ID.includes('YOUR_APPLE')) {
          addLog('Apple Client ID ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤!', 'error');
          if (clientIdWarning) {
            clientIdWarning.style.display = 'block';
          }
          if (appleLoginBtn) {
            appleLoginBtn.disabled = true;
          }
          return;
        }
        
        try {
          AppleID.auth.init({
            clientId: APPLE_CLIENT_ID,
            scope: 'name email',
            redirectURI: APPLE_REDIRECT_URI,
            usePopup: true
          });

          // ‡∏ü‡∏±‡∏á event ‡∏à‡∏≤‡∏Å Apple Sign In
          document.addEventListener('AppleIDSignInOnSuccess', handleAppleSignIn);
          document.addEventListener('AppleIDSignInOnFailure', (event) => {
            addLog('Apple Sign-In failed: ' + JSON.stringify(event), 'error');
            showError('Apple Sign-In failed: ' + JSON.stringify(event));
          });

          addLog('Apple Sign-In initialized successfully', 'success');
          
          if (appleLoginBtn) {
            appleLoginBtn.disabled = false;
          }
          
        } catch (error) {
          addLog('Error initializing Apple Sign-In: ' + error.message, 'error');
          showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ initialize Apple Sign-In: ' + error.message);
        }
      } else {
        setTimeout(initializeAppleSignIn, 500);
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login ‡∏î‡πâ‡∏ß‡∏¢ Google
     */
    async function signInWithGoogle() {
      try {
        addLog('Starting Google Login...', 'info');

        if (typeof google === 'undefined' || !google.accounts) {
          const error = 'Google Identity Services SDK ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à';
          addLog(error, 'error');
          showError(error);
          return;
        }

        if (!GOOGLE_CLIENT_ID || GOOGLE_CLIENT_ID.includes('407047949381-8r5beccl81cd50jfebhiha6m6svbtqb6.apps.googleusercontent.com')) {
          const error = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google OAuth Client ID';
          addLog(error, 'error');
          showError('‚ö†Ô∏è ' + error);
          return;
        }

        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
        if (userInfo) userInfo.style.display = 'none';
        if (tokenInfo) tokenInfo.style.display = 'none';
        if (errorMessage) errorMessage.style.display = 'none';

        // Initialize ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ initialize
        if (!googleSignInInitialized) {
          google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true
          });
          googleSignInInitialized = true;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á container ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö render button
        const buttonContainer = document.createElement('div');
        buttonContainer.style.position = 'absolute';
        buttonContainer.style.left = '-9999px';
        buttonContainer.style.top = '-9999px';
        document.body.appendChild(buttonContainer);

        // Render button
        google.accounts.id.renderButton(buttonContainer, {
          type: 'standard',
          theme: 'outline',
          size: 'large',
          text: 'signin_with',
          width: 300
        });

        // ‡∏Ñ‡∏•‡∏¥‡∏Å button
        setTimeout(() => {
          const button = buttonContainer.querySelector('div[role="button"]');
          if (button) {
            button.click();
            setTimeout(() => {
              if (buttonContainer.parentNode) {
                buttonContainer.parentNode.removeChild(buttonContainer);
              }
            }, 100);
          } else {
            google.accounts.id.prompt((notification) => {
              if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                const error = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á Google Sign-In ‡πÑ‡∏î‡πâ';
                addLog(error, 'error');
                showError(error);
                if (buttonContainer.parentNode) {
                  buttonContainer.parentNode.removeChild(buttonContainer);
                }
              }
            });
          }
        }, 100);

      } catch (error) {
        addLog('Error during Google Sign-In: ' + error.toString(), 'error');
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google: ' + error.toString());
      }
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login ‡∏î‡πâ‡∏ß‡∏¢ Apple
     */
    async function signInWithApple() {
      try {
        addLog('Starting Apple Login...', 'info');

        if (typeof AppleID === 'undefined') {
          const error = 'Apple Sign In SDK ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à';
          addLog(error, 'error');
          showError(error);
          return;
        }

        if (!APPLE_CLIENT_ID || APPLE_CLIENT_ID.includes('YOUR_APPLE')) {
          const error = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apple Client ID';
          addLog(error, 'error');
          showError('‚ö†Ô∏è ' + error + '\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: const APPLE_CLIENT_ID = "...";');
          return;
        }

        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
        if (userInfo) userInfo.style.display = 'none';
        if (tokenInfo) tokenInfo.style.display = 'none';
        if (errorMessage) errorMessage.style.display = 'none';

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Apple Sign In
        AppleID.auth.signIn({
          requestedScopes: ['name', 'email']
        });

      } catch (error) {
        addLog('Error during Apple Sign-In: ' + error.toString(), 'error');
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Apple: ' + error.toString());
      }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    window.addEventListener('load', () => {
      addLog('Page loaded, initializing...', 'info');
      setTimeout(() => {
        initializeGoogleSignIn();
        initializeAppleSignIn();
      }, 1000);
    });

    // Export functions
    window.signInWithGoogle = signInWithGoogle;
    window.signInWithApple = signInWithApple;
    window.signOut = signOut;
  </script>
</body>
</html>



